## 第1章　HDRP入门

介绍HDRP场景组成

## 第2章　实现市政厅办公室场景

以实例介绍HDRP组成

## 第3章　HDRP配置文件和Volume框架详解

1. HDRP配置文件（HDRP Asset）

   * Frame.Settings（帧设置）

     帧设置针对的是场景中的Camera （相机）、Baked or Cuatom Reflection（烘培或自定义反射帧设置）和Realtime Reflection （实时反射）的相关设置。后面两个反射相关的设管应用在Reflection Probe（反射探针）组件上。

     帧设置的优先级低于HDRP配置文件，也就是说，如果在HDRP配置文件中没有打开某项功能，那么帧设置中对应的功能就会被自动禁用。

   * Volume框架.

     Volume的作用是通过调整各项HDRP功能的参数，影响相机所看到画面的最终渲染效果。

     volume的优先级低于帧设置，也就是说，如果在当前相机的倾设置中没有打开某项功能，那么在Volume中对相关功能的调整是不起作用的

   * 针对不同平台使用不同的HDRP配置文件

   ![IMG_4509](./IMG_4509.png)

2. Volume框架详解（后续章节会分开详细介绍以下功能）

   * Exposure（曝光控制）
   * Fog（雾效制作）
   * Lighting（光照）
   * Material（材质）
   * Shadowing（阴影处理）
   * Sky（天空）
   * Post-processing（后处理）
   * Ray.Tracing（实时光线追踪）
   * Local.Volume（本地Volume）使用示例

## 第4章　HDRP光照系统详解

### 一、场景打光步骤解析

1. 启用Scene.Settings.Volume
2. 启用Directional.Light（平行光）
3. 启用Volume中的自动曝光控制
4. 启用所有灯笼模型和点光源
5. 启用场景中所有反射探针（Reflection.Probe）
6. 启用场景中的光照探针组（Light.Probe.Group）
7. 完成整个场景的光照烘焙
8. 增强间接光强度
9. 处理阴影和环境光遮蔽.
10. 添加雾效
11. 画面抗锯齿处理
12. 添加后处理Volume组件

### 二、场景打光步骤解析

1. 修改Directional.Light设置

   * 修改Scene.Settings.Volume→HDRI.Sky设置
   * 修改Scene.Settings.Volume→Exposure（曝光）设置
   * 修改Scene.Settings.Volume→Fog（雾效）设置
   * 修改Scene.Settings.Volume→Contact.Shadow（接触阴影）设置
   * 修改Post.Processing.Volume→Color.Adjustment（颜色调整）设置
   * 修改Post.Processing.Volume→White.Balance（白平衡）设置

2. 光源类型和模式

   * 如何制作和使用Light.Cookie为灯光添加更多细节

     本质为在射出的光线前添加一张图片

   * 光照相关的常见问题汇总

     1. 为什么场景中出现奇怪的阴影块

        灯光数超过24，Project setting -> HDRP default setting -> Default Frame -> light loop

     2. 为什么相机移动场景中的阴影会扭曲或者闪烁

        启用了HDRP中的阴影Dynamic Rescale

     3. 未启用体积光的高质量，但是场景中的灯光雾效有很多噪点

        编辑器只是预览，打包就好

3. 光源分层

4. 使用光照探针

   * 为什么要使用光照探针

     为动态和静态物体提供间接光照信息

   * 使用光照探针的基本步骤

     1. 创建光照组
     2. 光照烘焙生成间接光
     3. 调整光照组

5. 使用Reflection Probe为场景提供反射信息

   * Screen.Space.Reflection（屏幕空间反射）
   * Reflection.Probe（反射探针）
   * Sky.reflection（天空反射）

6. 阴影 

   * 阴影的种类

     光源投射阴影和基于屏幕空间信息计算阴影(Contact shadow 、Micro shadow、Ambient Occlusion环境光遮蔽)

   * 三种光照模式

   * 两种Shadowmask模式下的阴影表现

   * 阴影的最大投射距离设置

   * Distance.Shadowmask和Shadowmask两种模式对性能的影响

     前者消耗GPU效果好，后者消耗内存

## 第5章　Lightmapping（光照烘焙）详解

5.1　摘要 .............................................................................................................................250
5.2　渐进式光照贴图烘焙对场景中的模型有什么要求 .................................................252
5.3　渐进式光照贴图烘焙对硬件的要求是什么？支持Unity的哪些渲染管线 .....257
5.4　进行渐进式光照贴图烘焙时烘焙出来的是什么 .....................................................257
5.5　渐进式光照贴图烘焙的CPU版本和GPU版本有什么区别 ..................261
5.6　光照贴图烘焙界面参数详解 .....................................................................................261
5.7　不同显卡对GPU版本的烘焙效率有什么影响 ................................275
5.8　相同场景使用CPU烘焙需要多长时间 .............................................279
5.9　为什么GPU版本在烘焙的过程中，有时会自动切换成CPU版本 ..............279
5.10　如何避免GPU烘焙自动切换成CPU烘焙 ..............................................280
5.11　如何解决光照贴图接缝问题 ..............................................................282
5.12　如何整体地查看光照贴图的不同组成部分 .......................................283
5.13　如何查看场景中的模型在光照贴图中的位置？
如何调整模型在光照贴图中的占比大小 ...............................................................284
5.14　本章总结 ........................................................................288

## 第6章　HDRP材质详解...........................................................................................289

6.1　摘要 .............................................................................................................................289
6.2　使用Lit着色器制作典型材质 ....................................................................................290
6.2.1　木头材质.......................................................................................................290
6.2.2　冰箱材质.......................................................................................................298
6.2.3　陶瓷材质.......................................................................................................300
6.2.4　（普通）玻璃材质.......................................................................................306
6.2.5　（带折射的）玻璃材质. ...............................................................................312
6.2.6　半透明材质和次表面散射材质....................................................................317
6.2.7　自发光材质...................................................................................................327
6.2.8　Decal（贴花）的具体使用方法...................................................................330
6.3　渲染器和材质优先级 .................................................................................................339
6.4　使用HDRP自带的示例材质库 ...........................................340
6.4.1　金属箔材质...................................................................................................342
6.4.2　肥皂泡材质...................................................................................................345
6.5　本章总结 .....................................................................................................................348

## 第7章　Post.Processing后处理详解. ........................................................................350

7.1　摘要 .............................................................................................................................350
7.2　为场景添加后处理效果的步骤 .................................................................................351
7.3　后处理效果应用顺序和效果组合 .............................................................................351
7.4　HDRP中的后处理效果 .....................................................352
7.4.1　Tonemapping（色调映射）.........................................................................353
7.4.2　White.Balance（白平衡）............................................................................354
7.4.3　Bloom（泛光）............................................................................................354
7.4.4　Film.Grain（胶片颗粒）..............................................................................356
7.4.5　Depth.of.Field（景深）................................................................................357
7.4.6　Panini.Projection（帕尼尼投影）................................................................359
7.4.7　Lens.Distortion（镜头畸变）.......................................................................360
7.4.8　Motion.Blur（运动模糊）. ...........................................................................360
7.4.9　Chromatic.Aberration（色差）.....................................................................362
7.4.10　Vignette（晕映）........................................................................................363
7.4.11　Lift、Gamma和Gain（颜色分级）.............................................................364
7.4.12　Channel.Mixer（通道混合）......................................................................365
7.4.13　Color.Curve（颜色曲线）.........................................................................366
7.4.14　Color.Adjustment（颜色调整）.................................................................367
7.4.15　Split.Toning（分离调色）..........................................................................368
7.4.16　Shadow、Midtones、Highlights（阴影、中间调、高光）.......................369
7.5　本章总结 .....................................................................................................................370

## 第8章　HDRP.Debug窗口介绍................................................................................371

8.1　摘要 .............................................................................................................................371
8.2　Material（材质）相关的Debug窗口 ................................................372
8.3　Lighting（光照）相关的Debug窗口 ........................................374
8.4　Camera（相机）相关的Debug窗口 .......................................376
8.5　MatCap显示模式的使用方法 ............................................................378
8.6　本章总结 .....................................................................................................................380

## 第9章　HDRP在VR中的应用...................................................................................381

9.1　摘要 .............................................................................................................................381
9.2　HDRP VR支持的平台 ....................................................................381
9.2.1　系统要求.......................................................................................................381
9.2.2　支持的平台...................................................................................................382
9.3　配置HDRP项目以支持VR ........................................................382
9.4　可以应用到VR中的HDRP功能 ................................................387
9.5　将市政厅办公室场景转换成HDRP VR ....................................388
9.5.1　配置HDRP+VR...........................................................................................388
9.5.2　配置XR.Plug-in.Management......................................................................388
9.5.3　添加XR.Interaction.Toolkit..........................................................................388
9.5.4　创建XR.Rig、控制器和瞬移区域...............................................................389
9.5.5　创建转向系统...............................................................................................395
9.5.6　创建可交互物体...........................................................................................396
9.5.7　构建项目到设备...........................................................................................397
9.6　在VR设备中进行Debug ..............................................398
9.7　本章总结 .....................................................................................................................400

## 第10章　HDRP.Custom.Pass应用..........................................................................401

10.1　摘要 .................................................................401
10.2　Custom Pass实例解析 ..................................................401
10.2.1　实例讲解1...................................................................................................402
10.2.2　实例讲解2...................................................................................................407
10.3　如何查看Custom Pass的渲染阶段 ..................................408
10.4　本章总结 .....................................................................................409

## 第11章　HDRP实时光线追踪项目应用......................................................................410

11.1　摘要 .................................................................................410
11.1.1　运行光追应用所需的软硬件......................................................................411
11.1.2　Unity光追功能在编辑器中的位置.............................................................411
11.2　配置HDRP光追项目 .........................................................414
11.2.1　将普通HDRP项目升级到支持光追的HDRP项目....................................414
11.2.2　进一步设置HDRP配置文件（HDRP.Asset）启用相关的光追功能. .......417
11.2.3　在HDRP.Default.Settings界面启用相机的Frame.Settings中的光追功能.....421
11.2.4　在Scene窗口打开相机的抗锯齿功能和启用刷新设置..............................422
11.3　光追功能的使用方法 ..............................................................423
11.3.1　环境光遮蔽.................................................................................................424
11.3.2　屏幕空间反射.............................................................................................427
11.3.3　屏幕空间全局光.........................................................................................431
11.3.4　Light.Cluster的使用.....................................................................................433
11.3.5　屏幕空间阴影.............................................................................................439
11.3.6　次表面散射.................................................................................................443
11.3.7　递归式渲染.................................................................................................450
11.3.8　路径追踪.....................................................................................................453